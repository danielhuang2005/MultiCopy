/*******************************************************************************
 *
 *            Copyright (–°) 2011 –Æ—Ä–∏–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á –ö—Ä—É–≥–ª–æ–≤
 *
 * –≠—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º. –í—ã –º–æ–∂–µ—Ç–µ
 * —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∏/–∏–ª–∏  –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –µ—ë —Å–æ–≥–ª–∞—Å–Ω–æ —É—Å–ª–æ–≤–∏—è–º –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π
 * –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –õ–∏—Ü–µ–Ω–∑–∏–∏ GNU, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –°–≤–æ–±–æ–¥–Ω–æ–≥–æ
 * –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –û–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –≤–µ—Ä—Å–∏–∏ 3, –ª–∏–±–æ –ø–æ –í–∞—à–µ–º—É –∂–µ–ª–∞–Ω–∏—é, –ª—é–±–æ–π –±–æ–ª–µ–µ
 * –ø–æ–∑–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏.
 *
 * –≠—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –Ω–∞–¥–µ–∂–¥–µ –Ω–∞ —Ç–æ, —á—Ç–æ –æ–∫–∞–∂–µ—Ç—Å—è –ø–æ–ª–µ–∑–Ω–æ–π, –Ω–æ
 * –ë–ï–ó –ö–ê–ö–ò–•-–õ–ò–ë–û –ì–ê– –ê–ù–¢–ò–ô, –¥–∞–∂–µ –±–µ–∑ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ–º—ã—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π –û–ö–£–ü–ê–ï–ú–û–°–¢–ò –∏–ª–∏
 * –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –ö–û–ù–ö– –ï–¢–ù–´–ú –¶–ï–õ–Ø–ú.
 * –ü–æ–¥—Ä–æ–±–Ω–µ–µ - —Å–º. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—É—é –õ–∏—Ü–µ–Ω–∑–∏—é GNU.
 *
 * –í—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–ø–∏—é –û—Å–Ω–æ–≤–Ω–æ–π –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –õ–∏—Ü–µ–Ω–∑–∏–∏ GNU –≤–º–µ—Å—Ç–µ —Å
 * —ç—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π. –ü—Ä–∏ –µ—ë –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç
 * http://www.gnu.org/licenses/.
 *
 *******************************************************************************
 *
 *                 Copyright (C) 2011 Yuri V. Krugloff
 *
 * This program is free software: you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 *
 ******************************************************************************/

#include "TimeCounter.hpp"

#include <QDateTime>

//------------------------------------------------------------------------------
//! –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

TTimeCounter::TTimeCounter()
    : m_Started(false),
      m_Paused(false),
      m_msec(0),
      m_Pause_msec(0)
{
}

//------------------------------------------------------------------------------
//! –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä.

TTimeCounter::~TTimeCounter()
{
}

//------------------------------------------------------------------------------
//! –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞.
/*!
 * \remarks –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä.
 */

void TTimeCounter::start()
{
    m_Started = true;
    m_Paused = false;
    m_StartTime = QDateTime::currentMSecsSinceEpoch();
    m_msec = 0;
    m_Pause_msec = 0;
}

//------------------------------------------------------------------------------
//! –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞.

void TTimeCounter::stop()
{
    if (m_Started)
    {
        m_Started = false;
        m_Paused = false;
        m_msec = QDateTime::currentMSecsSinceEpoch() - m_StartTime
                                                     - m_Pause_msec;
    }
}

//------------------------------------------------------------------------------
//! –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞.
/*!
 * \remarks –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ —É–∂–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –º–µ—Ç–æ–¥ –Ω–∏—á–µ–≥–æ –Ω–µ
 *   –¥–µ–ª–∞–µ—Ç.
 */

void TTimeCounter::pause()
{
    if (!m_Paused && m_Started)
    {
        m_Paused = true;
        m_PauseTime = QDateTime::currentMSecsSinceEpoch();
    }
}

//------------------------------------------------------------------------------
//! –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏.
/*!
 * –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –º–µ—Ç–æ–¥ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç.
 */

void TTimeCounter::resume()
{
    if (m_Paused)
    {
        Q_ASSERT(m_Started);
        m_Paused = false;
        m_Pause_msec += QDateTime::currentMSecsSinceEpoch() - m_PauseTime;
    }
}

//------------------------------------------------------------------------------
//! –ß–∏—Å–ª–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ —Å –º–æ–º–µ–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞.
/*!
 * –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥, –ø—Ä–æ—à–µ–¥—à–µ–µ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
 * —Ç–∞–π–º–µ—Ä–∞ –º–µ—Ç–æ–¥–æ–º start –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –∏–ª–∏ –µ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–µ—Ç–æ–¥–æ–º stop.
 */

qint64 TTimeCounter::msec() const
{
    if (m_Started)
    {
        if (m_Paused)
            // –ó–∞–ø—É—â–µ–Ω–æ –∏ –Ω–∞ –ø–∞—É–∑–µ.
            return m_PauseTime - m_StartTime - m_Pause_msec;
        else
            // –ó–∞–ø—É—â–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.
            return QDateTime::currentMSecsSinceEpoch() - m_StartTime
                                                       - m_Pause_msec;
    }
    else {
        // –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.
        return m_msec;
    }
}

//------------------------------------------------------------------------------
/*!
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ false –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
 */

bool TTimeCounter::isStarted() const
{
    return m_Started;
}

//------------------------------------------------------------------------------
/*!
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ false –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.
 */

bool TTimeCounter::isPaused() const
{
    return m_Paused;
}

//------------------------------------------------------------------------------

